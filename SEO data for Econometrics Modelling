WITH
kc AS (
  SELECT
    distinct
    kc.k,
    kc.sub_vertical,
    kc.vertical 
    
    FROM
    `rvu-seo.reporting.keywords_in_classified_sheet_master` kc),
    
  sc AS (
  SELECT
    FORMAT_DATE("%Y-%m-%d",DATE_TRUNC(date, WEEK(Monday))) AS date_week,
    keyword,
    AVG(position) AS avg_pos,
    SUM(impressions) AS impressions,
    SUM(clicks) AS clicks,
    AVG(ctr) AS ctr
  FROM
    `rvu-seo.search_console.search_console_dashboard_view`
  GROUP BY
    1,
    2)
SELECT     
  sc.date_week, 
  kc.sub_vertical,
  kc.vertical,
  sc.keyword,
  sc.avg_pos,
  sc.impressions,
  sc.clicks,
  sc.ctr  
  
  FROM kc join sc on kc.k = sc.keyword
  Where sc.date_week  between '2018-12-31' and '2019-11-23'

  Order by date_week desc
